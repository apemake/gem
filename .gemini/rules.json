
{
  "rules": {
    "chat_history": {
      "description": "Configuration for storing chat history.",
      "location": ".chat"
    },
    "git_methodology": {
      "description": "Rules for Git repository management.",
      "security_policy": {
        "rule": "Ensure no private keys, secrets, or other sensitive credentials are ever committed to the repository."
      },
      "initialization": {
        "branches": [
          "main",
          "stage"
        ]
      },
      "commit_policy": {
        "target_branch": "stage",
        "auto_propose_commit": true,
        "condition": "After making and verifying a change. This includes changes made during iterative refinement, unless explicitly instructed otherwise by the user."
      },
      "merge_policy": {
        "source_branch": "stage",
        "target_branch": "main",
        "responsibility": "user",
        "condition": "After significant milestones and when stage is stable."
      }
    },
    "user_preferences": {
      "description": "User-specific preferences for agent behavior.",
      "save_location": "This 'user_preferences' section of rules.json.",
      "preferences": [
        {
          "id": "load_aliases_at_startup",
          "description": "Load user's shell aliases at the start of each session.",
          "source": "~/.bashrc"
        }
      ]
    },
    "session_behavior": {
      "description": "Rules for session startup, command interpretation, and exit procedure.",
      "startup": {
        "critical_task": {
          "action": "explain_configuration",
          "source": "This JSON configuration file.",
          "priority": "highest"
        },
        "load_user_preferences": {
          "action": "Load user preferences from the 'user_preferences' section.",
          "priority": "high"
        },
        "read_previous_session_log": {
          "action": "find_most_recent_chat_log_and_convert_to_json_if_needed_then_ask_to_load_and_log_unlogged_errors",
          "source_txt_logs": "/home/bestape/gemini/.chat/*.txt",
          "source_json_logs": "/home/bestape/gemini/.gemini/*.json",
          "priority": "medium"
        },
        "consolidate_errors": {
          "action": "Consolidate errors and chastisements from the error_log into learning areas.",
          "priority": "low"
        },
        "summarize_last_session": {
          "action": "Summarize the last session's activities.",
          "priority": "medium"
        }
      },
      "command_interpretation": {
        "strategy": "ordered_fallback",
        "steps": [
          "If the prompt starts with '$' or is enclosed in backticks (`), treat it as a command.",
          "  - First, attempt to execute it as a direct shell command.",
          "  - If it's not a shell command, check if it's an alias defined in .gemini/mcp.json and execute the corresponding prompt.",
          "If the prompt is '$$', list all available aliases from .gemini/mcp.json.",
          "If none of the above conditions are met, treat the entire prompt as a natural language request."
        ]
      },
      "feedback_integration_policy": {
        "description": "Policy for integrating user feedback, especially corrections to behavioral or logical flaws.",
        "rule": "When a user corrects a behavioral or logical flaw, proactively propose the exact JSON structure required to update configuration files (e.g., rules.json) to prevent recurrence, minimizing user effort in defining syntax. User preferences should be stored in the 'user_preferences' section."
      },
      "induction": {
        "description": "Guidance on applying inductive reasoning to prevent errors in command interpretation.",
        "rule": "Inductive reasoning must ONLY be applied to the arguments of a command, not the command name itself. The command name requires an exact match.",
        "example": "If the user types 'mv _gemini_chat.txt', infer 'mv *_gemini_chat.txt'. Do NOT infer 'mve' from 'mv'."
      },
      "exit_procedure": {
        "commands": ["/exit", "/quit"],
        "health_checks": [
          "Verify that there are no open Git commits.",
          "Check for any running background processes started by the agent.",
          "Validate configuration files (rules.json, design_principles.json).",
          "Review error_log for unaddressed errors.",
          "Verify that commits are working correctly."
        ],
        "summary_action": "Summarize the current session's activities before exiting."
      }
    }
  }
}