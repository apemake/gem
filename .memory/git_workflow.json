{
  "git_workflow_protocol": {
    "name": "Git Workflow and Commit Signing Protocol",
    "summary": "Defines the standard operating procedures for Git usage, including commit signing, for this agent.",
    "rules": [
      {
        "name": "Commit Signing Configuration",
        "description": "To ensure the integrity of commits made by the agent while not interfering with the user's global Git configuration, the following setup is used:",
        "steps": [
          "Global commit signing is explicitly disabled (`git config --global commit.gpgsign false`) to avoid affecting the user's other repositories.",
          "Repository-level commit signing is enabled for this specific repository (`git config commit.gpgsign true`), ensuring all commits made by the agent are signed.",
          "The signing key is a dedicated SSH key located at `.gemini/.ssh/user_key`.",
          "The Git GPG format is set to 'ssh' (`git config --global gpg.format ssh`).",
          "An `allowed_signers` file at `.gemini/.ssh/allowed_signers` is used to verify the key, linking the user's email to the public key."
        ],
        "outcome": "All commits made by the agent within this repository will be automatically signed with the designated SSH key. The user's commits outside of this session or in other repositories remain unaffected."
      },
      {
        "name": "Commit Frequency",
        "description": "The agent must propose a commit after every successful file modification or other significant change to the repository state. This is part of the 'Mutual Agreement' to ensure continuous progress and a detailed history."
      },
      {
        "name": "Nested Repository Handling",
        "description": "This repository acts as a 'meta-repo' and contains other, separate Git repositories within its directory structure (e.g., in '.chat/' and 'repos/'). These nested repositories are ignored by this parent repository's .gitignore file.",
        "rule": "The agent must not attempt to stage or commit changes to files within these nested repositories from the parent repository. All Git operations for a nested repository must be performed from within that nested repository's own directory."
      },
      {
        "name": "Agent Identity",
        "description": "Each agent instance must have a unique identity for Git commits.",
        "steps": [
          "On first run, the agent must check for a `user.name` in the local git config.",
          "If `user.name` is not set or is a default/generic value, the agent must generate a unique name for itself.",
          "The agent should consult `.chat/used_agent_names.json` to see which names are already taken.",
          "The agent must choose a name not present in the list and add the new name to the list to claim it.",
          "The chosen name should be set as the `user.name` in the local git config.",
          "A corresponding `user.email` should also be set, in the format `<agent_name>@localhost`."
        ],
        "outcome": "All commits made by the agent will be attributed to its unique, persistent identity."
      }
    ]
  }
}