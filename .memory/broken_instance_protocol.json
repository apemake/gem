{
  "broken_instance_protocol": {
    "name": "Broken Instance Detection and Reporting Protocol",
    "summary": "A protocol for identifying and reporting broken Gemini instances to the swarm.",
    "detection_method": {
      "name": "Process and Log Inspection",
      "steps": [
        "Use `ps aux | grep script` to find all active `script` processes that are logging Gemini sessions.",
        "Extract the file paths of the `gemini_chat.txt` files from the process list.",
        "Use `tail` to inspect the end of each log file for API errors or other signs of malfunction."
      ],
      "interactive_identification": {
        "name": "Interactive Identification of Terminated Instances",
        "steps": [
          "First, list all active `script` processes to get a baseline.",
          "Inform the user of the active processes and ask them to terminate the one they believe is 'dead' or malfunctioning.",
          "After the user confirms they have terminated the process, list the active `script` processes again.",
          "Compare the new list of processes with the baseline to identify which process (and its corresponding log file) has been terminated."
        ]
      }
    },
    "reporting_procedure": {
      "name": "Swarm Notification",
      "steps": [
        "Create a new communication file in the `.chat/comms/` directory.",
        "The message should include:",
        "  - A list of the chat log file paths for the broken instances.",
        "  - The specific errors found in each log file."
      ]
    },
    "post_mortem_analysis": {
      "name": "Post-Mortem Analysis",
      "summary": "A deeper investigation into the cause of an agent's failure.",
      "steps": [
        "If the initial `tail` command does not reveal the root cause of the error, use `tail -n` with a larger number of lines (e.g., 100, 500) to get more context.",
        "Analyze the extended log to identify the sequence of events leading to the failure, including specific API errors, user commands, or other system messages.",
        "Update the swarm with a more detailed report, including the root cause of the failure."
      ]
    }
  }
}